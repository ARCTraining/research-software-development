<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <title>Research Software Development in Python – Dependency management</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-e3a8c08a45cfedd587804280fbfd31c5.css">
  
  <script type="text/javascript" charset="UTF-8">
  document.addEventListener('DOMContentLoaded', function () {
  cookieconsent.run({
    "notice_banner_type":"simple",
    "consent_type":"implied",
    "palette":"light",
    "language":"en",
    "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
    "notice_banner_reject_button_hide":false,
    "preferences_center_close_button_hide":false,
    "website_name":""
    ,
  "language":"en"
    });
  });
  </script> 
    
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Dependency management</h1>
  <p class="subtitle">Preventing dependency hell</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="what-are-dependencies" class="slide level2 smaller">
<h2>What are dependencies?</h2>
<p>Dependencies are the versions of various different modules, packages, or software that your research code depends on: all of your imports.</p>
<div class="columns">
<div class="column" style="width:70%;">
<p><img data-src="https://jhudatascience.org/Reproducibility_in_Cancer_Informatics/resources/images/06-package-management_files/figure-html/1LMurysUhCjZb7DVF6KS9QmJ5NBjwWVjRn40MS9f2noE_gf62875ddf7_0_404.png" alt="Ruby has a particular computing environment she has developed her code from. This computing environment is represented as a bubble above her computer with various hexagons with version numbers as well as Rstudio and R installed on her computer. Her code ran just fine on her particular computing environment. Avi attempted to run Ruby’s code on his very different local computing environment and got an error. His computer runs the same code but came up with a different result!"></p>
</div><div class="column" style="width:30%;">
<p>Don’t be like Ruby and Avi! Record your dependencies.</p>
<div class="small">
<p>Image CC BY Candace Savonen, retrieved from <a href="https://jhudatascience.org/Reproducibility_in_Cancer_Informatics/managing-package-versions.html">Reproducibility in Cancer Informatics</a>.</p>
</div>
</div></div>
</section>
<section id="general-rules-for-dependencies" class="slide level2 smaller">
<h2>General Rules for Dependencies</h2>
<p>Managing dependencies is something many, many people find complicated and difficult. Let’s start with some key ideas to simplify things.</p>
<p><a href="https://guides.nyu.edu/software-reproducibility/dependencies">NYU Libraries</a> provide some straightforward guidance that is language agnostic:</p>
<ol type="1">
<li><span class="extra">Use dependencies wisely and sparingly:</span> don’t import dependencies you don’t actually use, and try to stick to libraries that have robust and stable releases.</li>
<li><span class="extra">Use a package manager of some form:</span> package management software, virtual environments and containers help to avoid conflicts and incompatibility errors between packages.</li>
<li><span class="extra">Record your dependencies in a metadata file:</span> package managers will often do this automatically for you; this file should be both human and machine readable.</li>
</ol>
</section>
<section>
<section id="where-to-begin" class="title-slide slide level1 section center">
<h1>Where to begin?</h1>

</section>
<section id="package-management-software" class="slide level2 smaller">
<h2>Package management software</h2>
<p>Package management software usually:</p>
<div class="small">
<ul>
<li>Provides a way for you to create an <span class="extra">environment</span>:
<ul>
<li>A code project <em>environment</em> will contain a selection of relevant libraries, with specific versions.</li>
<li>This is kept separate from other project <em>environments</em>.</li>
<li>This allows you to use different versions of libraries for different projects.</li>
</ul></li>
<li>Provides a way for you to <span class="extra">export your environment</span>:
<ul>
<li>This allows you to specify the exact libraries and library versions that were used to generate a set of results.</li>
<li>This makes it easier for others to use your work and built on it, and <em>reproduce</em> your code environment.</li>
<li>This saves you having to manually record library versions that you are using.</li>
</ul></li>
</ul>
</div>
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<p>Package management software <em>might also</em>:</p>
<div class="small">
<ul>
<li>Help you to solve <span class="extra">dependency conflicts</span>:
<ul>
<li>Conflicts can arise when different packages depend on different versions of other packages in the background.</li>
<li>This can be tricky to resolve.</li>
<li>Remember the guideline <span class="extra">“use dependencies wisely and sparingly”</span> to minimise this issue.</li>
</ul></li>
<li>Provide a way for you to package your own code into a library:
<ul>
<li>In addition to helping you juggle external dependencies, some package management solutions also provide a framework for turning your code into an installable package.</li>
</ul></li>
</ul>
</div>
</section>
<section class="slide level2">

<p>Depending on the language you are using, there may be many different options available. For example, for Python, you may have heard of:</p>
<ul>
<li><span class="outline-b"><strong>pip</strong></span></li>
<li><span class="outline-o"><strong>conda</strong></span></li>
<li><span class="outline-b"><strong>pixi</strong></span></li>
<li><span class="outline-o"><strong>uv</strong></span></li>
<li><span class="outline-b"><strong>poetry</strong></span></li>
</ul>
</section>
<section id="how-do-you-pick" class="slide level2">
<h2>How do you pick?</h2>
<h3 id="license">1. License</h3>
<ul>
<li>Does the package manager have an open-source license?</li>
</ul>
<h3 id="community">2. Community</h3>
<ul>
<li>What solution does your research group use? Does your supervisor have suggestions?</li>
<li>What option can you find support for?</li>
<li>What do researchers in your field use?</li>
</ul>
</section>
<section class="slide level2">

<h3 id="documentation">3. Documentation</h3>
<ul>
<li>Does the package manager have easy-to-understand instructions and tutorials available?</li>
</ul>
<h3 id="use-case">4. Use-case</h3>
<ul>
<li>Are you managing all external libraries, or are you building your own packages?</li>
<li>Are you going to be pinning dependencies (like for a web-app)?</li>
</ul>
</section></section>
<section>
<section id="conda" class="title-slide slide level1 center">
<h1>Conda</h1>

</section>
<section id="what-is-conda" class="slide level2">
<h2>What is conda?</h2>
<ul>
<li><h3 id="conda-is-a-widely-used-package-management-system">Conda is a widely used package management system</h3></li>
<li>This allows you to isolate different Python “environments” from each other, allowing you to use different versions of libraries or modules for different projects.</li>
<li>However, mismanagement of packages can lead to <a href="https://xkcd.com/1987/">dependency hell</a> with tangled environments and incompatible versions of different modules.</li>
</ul>
</section>
<section id="dependency-hell" class="slide level2" data-background-color="white">
<h2>Dependency hell</h2>

<img data-src="https://imgs.xkcd.com/comics/python_environment.png" class="r-stretch quarto-figure-center"><p class="caption">Python dependencies can get very messy…</p></section>
<section id="installing-conda-fun-licensing-details" class="slide level2 smaller">
<h2>Installing conda: fun licensing details</h2>
<div class="box-pb">
<p>In order to use conda on your machine, I recommend you use the <a href="https://conda-forge.org/download/">MiniForge installer</a>, which by default loads packages from <code>conda-forge</code>.</p>
</div>
<p>If you are using Anaconda (provided by Anaconda.com), ensure you are not using the <code>defaults</code> channel to install packages as this falls under the <a href="https://www.datacamp.com/blog/navigating-anaconda-licensing?dc_referrer=https%3A%2F%2Fwww.google.com%2F">recent Anaconda repository licensing changes</a>.</p>
<div class="box-lb">
<p>Tl;dr: stick to open source to avoid licensing issues, by using a tool such as Miniforge which by default downloads packages from <code>conda-forge</code> and not proprietary channels.</p>
</div>
</section></section>
<section>
<section id="yaml-files-the-solution-to-all-your-problems" class="title-slide slide level1 center">
<h1>Yaml files: the solution to all your problems</h1>

</section>
<section id="the-key-to-conda-the-.yml-file" class="slide level2">
<h2>The key to conda: the <code>.yml</code> file</h2>
<ul>
<li>Despite the fact conda is very widely used, especially in research, science, and data science fields, people often neglect the real magic of the system: the <code>environment.yml</code> file.</li>
<li>This file is the recipe or configuration for your environment.</li>
</ul>
<div class="box-pb">
<p>Who here regularly uses <code>environment.yml</code> files in their workflow?</p>
</div>
</section>
<section id="whats-yaml-or-yml" class="slide level2">
<h2>What’s Yaml or yml?</h2>
<ul>
<li><p>YAML is a <span class="extra">human readable</span> format for plain text files (usually with the file ending <code>.yml</code>), often used for <span class="extra">configuration</span> of other programs.</p></li>
<li><p>It’s the format <code>environment.yml</code> files are written in.</p></li>
</ul>
</section>
<section id="whats-in-a-yml-file" class="slide level2">
<h2>What’s in a <code>yml</code> file?</h2>
<p>What does a <code>.yml</code> file look like?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a></a><span class="fu">name</span><span class="kw">:</span><span class="at"> my-env-name</span></span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb1-4"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.12</span></span>
<span id="cb1-5"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytest</span></span>
<span id="cb1-6"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> setuptools</span></span>
<span id="cb1-7"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> blackd</span></span>
<span id="cb1-8"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> isort</span></span>
<span id="cb1-9"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> numpy</span></span>
<span id="cb1-10"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib</span></span>
<span id="cb1-11"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We just need to create a plain text file called <code>environment.yml</code> or something else sensible, and list the packages we need!</p>
</section>
<section id="create-a-new-environment" class="slide level2">
<h2>Create a new environment</h2>
<p>We can then turn this into a conda environment:</p>
<ul>
<li>Open up the terminal in the folder with our <code>environment.yml</code> file</li>
<li>run the following command:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="ex">conda</span> env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You’ll get a lot of output, as it finds the various packages online and goes about solving all your dependencies in the background.</p>
</section>
<section id="why-use-a-.yml-file" class="slide level2">
<h2>Why use a <code>.yml</code> file?</h2>
<p>Can’t I just create a fresh environment from the command line like this?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">conda</span> create <span class="at">-n</span> ENV-NAME python=3.12 numpy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And then activate it and add dependencies like this?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="ex">conda</span> install pytest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You absolutely can, but theres a few reasons why you <em>shouldn’t</em>.</p>
</section>
<section id="why-not" class="slide level2">
<h2>Why not?</h2>
<ol type="1">
<li>Things you install later (e.g.&nbsp;<code>pytest</code> on the last slide) will be pinned by the versions of libraries installed at an earlier stage (so the base <code>python</code> version and <code>numpy</code>), which can lead to dependency conflicts.</li>
<li>You can end up with a lot of crud and old unneeded libraries that you no longer used bloating your environment.</li>
<li>You don’t have a nice, tidy record of what you installed and when.</li>
</ol>
</section>
<section id="so-how-do-we-add-things" class="slide level2 smaller">
<h2>So how <em>do</em> we add things?</h2>
<p>If you want to add a new package that you didn’t include in your original <code>environment.yml</code> file, or pin a package to a specific version, you can go and do so within the <code>environment.yml</code>.</p>
<ul>
<li>Just add any new packages to the list of dependencies, and pin libraries with the <code>=</code> notation as in the first example.</li>
<li>Once your <code>environment.yml</code> file is up to date, you can apply the changes to your conda environment:</li>
</ul>
<div class="big">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">conda</span> env update <span class="at">--file</span> environment.yml <span class="at">--prune</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="box-pb">
<p>The <code>--prune</code> argument here clears out old unused libraries and is key to keeping your <code>.conda</code> folder a reasonable size.</p>
</div>
</section>
<section id="why-does-this-work" class="slide level2">
<h2>Why does this work?</h2>
<ul>
<li>Running <code>conda install package-name</code> from within your environment can lead to dependency conflicts (say your env has an older version of <code>numpy</code> and you’ve tried to <code>conda install</code> another package that can’t support this)</li>
<li>Updating the environment from the <code>.yml</code> file allows the solver to work through the dependencies at the same time. There may still be conflicts, but many easily avoidable issues will disappear.</li>
</ul>
</section>
<section id="myth-the-env.yml-is-too-prescriptive" class="slide level2">
<h2>Myth: the <code>env.yml</code> is too prescriptive</h2>
<ul>
<li>You may have struggled building a conda environment from a yml file before</li>
<li>This yml file may have had lots of <span class="extra">pinned</span> dependencies that don’t work on the system you are trying to install on</li>
<li>This leads people to think that environment files are too prescriptive/restrictive and not useful for sharing environments</li>
<li>This conda environment file may have been built with the <code>conda env export</code> command - let’s learn about it!</li>
</ul>
</section>
<section id="exporting-a-conda-env" class="slide level2">
<h2>Exporting a conda env</h2>
<p>Say you have a conda environment file similar to the one shown below, with very minimal pinned dependencies. For the sake of <strong>reproducibility</strong>, you want a better record of exactly what libraries you used, right?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a></a><span class="fu">name</span><span class="kw">:</span><span class="at"> my-env-name</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb6-4"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.12</span></span>
<span id="cb6-5"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytest</span></span>
<span id="cb6-6"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> setuptools</span></span>
<span id="cb6-7"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> blackd</span></span>
<span id="cb6-8"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> isort</span></span>
<span id="cb6-9"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> numpy</span></span>
<span id="cb6-10"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib</span></span>
<span id="cb6-11"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exporting-a-conda-env-1" class="slide level2">
<h2>Exporting a conda env</h2>
<p>This is where the <em>export</em> option comes in. From inside your active environment, simply run:</p>
<div class="big">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a></a><span class="ex">conda</span> env export <span class="op">&gt;</span> env-record.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="small">
<ul>
<li>The command above will export an extremely detailed list of everything in your environment (including background dependencies and their exact version numbers) to the file <code>env-record.yml</code>.</li>
<li>Sometimes, you might find it appropriate to export this to a filename with the date, for example <code>2024-11-27-env-record.yml</code>.</li>
</ul>
</div>
</section>
<section id="env.yml-files-being-restrictive" class="slide level2 smaller">
<h2><code>env.yml</code> files being restrictive</h2>
<p>This is where the myth of the conda <code>env.yml</code> being prohibitively restrictive comes in:</p>
<ul>
<li>people often try to use this exported file to build a replica of the same environment on a different machine</li>
<li>however this exported file contains specific details of backends and builds that will likely not be transferrable across different computers.</li>
</ul>
<p>This is why I prefer to export it into a file name like <em>env-record</em> instead of just <em>environment</em>: it makes it very obvious this is recording the state of the environment as opposed to building a recipe to rebuild it.</p>
</section>
<section id="exporting-conda-environments" class="slide level2 smaller">
<h2>Exporting conda environments</h2>
<ul>
<li><p><strong>This exported environment file is mainly useful as a record for the sake of reproducibility, not for <em>reusability</em>.</strong></p></li>
<li><p>If you produce results with your code that are being used in some form of research output (e.g.&nbsp;a paper), export your environment at the time when the results are being generated, so you have a record of the versions of different libraries you used.</p></li>
</ul>
<div class="box-pb">
<p>This is why I said it is good to build and update your environment from your <code>environment.yml</code> file: that way you have a <span class="extra">reusable recipe</span> that you can share and use to rebuild your environment, but you can also use <code>export</code> to get a super detailed snapshot for any sets of results!</p>
</div>
</section>
<section id="more-exporting" class="slide level2 smaller">
<h2>More exporting</h2>
<p>If you ignored all my advice about not building a haphazard environment incrementally with <code>conda install</code>, there is still hope: you can use the <code>--from-history</code> flag comes in to play:</p>
<div class="big">
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a></a><span class="ex">conda</span> env export <span class="at">--from-history</span> <span class="op">&gt;</span> environment.yml <span class="co"># again, from inside the activated env</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will produce a clean conda environment file similar to the example we gave at the start of this post, listing only the packages directly explicitly installed (without background dependencies or build details).</p>
<p>However, things will get messy if you start adding in <code>pip</code> dependencies…</p>
</section>
<section id="mixing-in-pip" class="slide level2">
<h2>Mixing in pip</h2>
<p>Using a conda <code>environment.yml</code> makes working with pip and conda together less painful.</p>
<ul>
<li>You will have heard (or experienced first hand) that once you install pip in a conda env, everything from that point on must be pip, or you will break the environment.</li>
<li>This is true, but you can get around this by adding your pip dependencies to your <code>environment.yml</code> file.</li>
</ul>
</section>
<section id="mixing-in-pip-1" class="slide level2">
<h2>Mixing in pip</h2>
<p>Just add your <code>pip</code> dependencies to your environment file, then run <code>conda env update --file environment.yml --prune</code> as previously described:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a></a><span class="fu">name</span><span class="kw">:</span><span class="at"> env-with-pip-dependencies</span></span>
<span id="cb9-2"><a></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb9-3"><a></a><span class="co"># Whatever packages you need for your project</span></span>
<span id="cb9-4"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.12</span></span>
<span id="cb9-5"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> numpy</span></span>
<span id="cb9-6"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib</span></span>
<span id="cb9-7"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas</span></span>
<span id="cb9-8"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip</span></span>
<span id="cb9-9"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb9-10"><a></a><span class="at">    </span><span class="kw">-</span><span class="at"> black</span></span>
<span id="cb9-11"><a></a><span class="at">    </span><span class="kw">-</span><span class="at"> https://github.com/YOUR-USERNAME/YOUR-REPO-NAME/releases/download/YOUR-VERSION-NAME/PACKAGENAME-VERSION.tar.gz</span><span class="co"> # you can even install your own packages that you host on GitHub</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can update this as described above.</p>
</section>
<section id="exporting-with-pip" class="slide level2">
<h2>Exporting with pip</h2>
<p>Exporting the full record works the same if you have pip dependencies:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">conda</span> env export <span class="op">&gt;</span> env-record.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, <code>--from-history</code> will not include pip dependencies…</p>
</section>
<section id="exporting-with-pip---advanced" class="slide level2 scrollable">
<h2>Exporting with pip - advanced</h2>
<p>However, <code>--from-history</code> will not include pip dependencies…</p>
<p>If you’ve followed our advice until now (and built your conda environment from a file), this won’t be an issue.</p>
<p>But if you ignored us or are trying to salvage old code, thankfully, there are a few different workarounds!</p>
<p>This is outside of the scope of the talk today, but the instructions for exporting are here:</p>
<p>Modified from this <a href="https://github.com/conda/conda/issues/9628#issuecomment-1608913117">conversation on GitHub</a>, this code snippet will export your conda and pip dependencies without version numbers (so that the <code>environment.yml</code> file can be used to build a new environment):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="co"># Extract installed pip packages</span></span>
<span id="cb11-2"><a></a><span class="va">pip_packages</span><span class="op">=</span><span class="va">$(</span><span class="ex">conda</span> env export <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-A9999</span> <span class="st">".*- pip:"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-v</span> <span class="st">"^prefix: "</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">"="</span><span class="va">)</span></span>
<span id="cb11-3"><a></a></span>
<span id="cb11-4"><a></a><span class="co"># Export conda environment without builds, and append pip packages</span></span>
<span id="cb11-5"><a></a><span class="ex">conda</span> env export <span class="at">--from-history</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-v</span> <span class="st">"^prefix: "</span> <span class="op">&gt;</span> new-environment.yml</span>
<span id="cb11-6"><a></a><span class="bu">echo</span> <span class="st">"</span><span class="va">$pip_packages</span><span class="st">"</span> <span class="op">&gt;&gt;</span> new-environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But remember: it is better to keep your <code>environment.yml</code> file current, and update your conda env <em>from</em> this file, as opposed to adding packages using <code>conda install</code> and then trying to export details to your environment file to track these changes.</p>
</section>
<section id="a-general-workflow" class="slide level2">
<h2>A general workflow</h2>
<ol type="1">
<li>Create your conda environment from an environment file, and update/add packages to your environment by using this file. You can keep this environment file <span class="extra">version controlled with git</span> alongside your code.</li>
<li>Export your conda environment to a record file when you change it and produce results with it. You can keep this environment record file <span class="extra">version controlled with git</span> alongside your results.</li>
</ol>
</section>
<section id="reproducibility-vs-reusability" class="slide level2 smaller">
<h2>Reproducibility vs reusability</h2>
<p>Remember that for reusability, you want:</p>
<ul>
<li>An easy-to install conda environment, that works across different computers.</li>
<li>You can share this with your code to make your work more <span class="extra">open</span></li>
</ul>
<p>For reproducibility, you need the code to be reusable, but also:</p>
<ul>
<li>You want an <em>exact</em> record of the environment as it was when you produced your results.</li>
</ul>
<p>Environments should be treated as disposable and easily rebuildable, we can use <span class="extra">version control</span> and <span class="extra">tests</span> to make sure that’s true.</p>
</section></section>
<section id="in-conclusion" class="title-slide slide level1 box-pb center">
<h1>In Conclusion</h1>
<ul>
<li>If you are using conda, use your conda <code>environment.yml</code> to keep control of the packages you have installed.</li>
<li>Use <code>conda env export &gt; env-record.yml</code> to export records of your environments for reproducibility, but use the <code>--from-history</code> tag to make it more reusable.</li>
</ul>
</section>



    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>